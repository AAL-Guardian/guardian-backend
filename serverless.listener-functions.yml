functions:
  iotTokenAuthorizer:
    handler: src/authorizers/iot.default
  elaborateDetectionUpload:
    handler: src/event-handlers/elaborate-raw-detect-audio.default
    timeout: 900
    events:
      - s3:
          bucket: ${self:custom.resources.audioBucket}
          event: s3:ObjectCreated:*
          existing: true
          rules:
            - suffix: .base64
            - prefix: detections/
  elaborateAnswerUpload:
    handler: src/event-handlers/elaborate-raw-answer-audio.default
    timeout: 900
    events:
      - s3:
          bucket: ${self:custom.resources.audioBucket}
          event: s3:ObjectCreated:*
          existing: true
          rules:
            - suffix: .base64
            - prefix: answers/
  elaborateDetectionPicture:
    handler: src/event-handlers/elaborate-raw-photo.default
    timeout: 900
    events:
      - s3:
          bucket: ${self:custom.resources.audioBucket}
          event: s3:ObjectCreated:*
          existing: true
          rules:
            - suffix: .base64
            - prefix: photos/
  # audioSignalReaction:
  #   handler: src/event-handlers/audio-signal-reaction.default
  #   events:
  #     - s3:
  #         bucket: ${self:custom.resources.audioBucket}
  #         event: s3:ObjectCreated:*
  #         existing: true
  #         rules:
  #           - suffix: .base64
  # elaborateSchedulerEvent:
  #   handler: src/event-handlers/scheduler-event-changed.default
  #   events:
  #     - stream:
  #         type: dynamodb
  #         arn:
  #           Fn::GetAtt: [schedulerTable, StreamArn]
  elaborateSchedulerRatioEvent:
    handler: src/event-handlers/scheduler-event-ratio.default
    events:
      - schedule:
          rate: cron(* * * * ? *)
          enabled: true
  seniorAppEventReaction:
    handler: src/event-handlers/senior-app-event-reaction.default
    events:
      - iot:
          sql: "SELECT * as data, topic(1) as robot_topic, topic(4) as event_type FROM '+/senior-app/events/+'"
          enabled: true
          sqlVersion: '2016-03-23'
  seniorAppAnswer:
    handler: src/event-handlers/senior-app-answer.default
    events:
      - iot:
          sql: "SELECT reportRequest, reportSetup, topic(1) as robot_topic FROM '+/senior-app/answer'"
          enabled: true
          sqlVersion: '2016-03-23'
  robotEventHandler:
    handler: src/event-handlers/robot-event-reaction.default
    events:
      - iot:
          sql: "SELECT * as data, topic(1) as robot_topic FROM '+/event'"
          enabled: true
          sqlVersion: '2016-03-23'
  periodicListeningAction:
    handler: src/event-handlers/periodic-listening-action.default
    events:
      - schedule:
          rate: cron(0/15 6-22 ? * * *)
          enabled: true
    